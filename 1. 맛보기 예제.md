# 맛보기 예제
### 원래의 프로그램
맛보기 예제는 단순히 비디오 대여점에서 고객의 대여료 내역을 계산하고 출력하는 간단한 프로그램이다. 이 프로그램은 고객이 대여한 비디오와 대여 기간을 표시한 후, 비디오 종류와 대여 기간을 토대로 대여료를 계산한다. 비디오 종류는 일반물, 아동물, 최신물 세 종류다. 대여료 계산과 더불어 내역을 바탕으로 적립 포인트도 계산되는데, 이 포인트는 비디오가 최신물인지 아닌지에 따라 달라진다.
#### 맛보기 프로그램 설명
시스템 수정은 인간이 하는 작업인지라 사람인 이상 코드가 지저분하면 거슬리게 마련이다. 설계가 조잡한 시스템은 어디를 수정해야 하는지 찾기 힘들어 수정도 어렵다. 수정할 위치를 찾기 힘들면 프로그래머가 실수할 가능성이 높아져서 버그가 생긴다. 

앞으로 영원히 수정할 일 없는 프로그램이라면 복사해서 붙이는 것은 문제가 없지만, 사용 기간이 길고 추후 수정해야 할 가능성이 있는 프로그램은 복사해서 붙이는 과정에서 큰 문제가 생길 수 있다. 그래서 매번 코드를 복사해서 붙일 필요가 없게 프로그램을 수정해야 한다. 

"긁어 부스럼 만들지 말라"는 구닥다리 개발 격언을 떠올리며, 에러 없이 돌아가기만 하면 된다고 자기합리화를 하면서 프로그램을 웬만해선 수정하지 않으려 할지도 모르지만, 프로그램이 당장은 문제가 없을지 몰라도 나중엔 사용자가 요구한 기능을 수정하기 힘들어서 애먹을 것이다. 이 상황이 바로 리팩토링해야 할 시점이다. 
> 프로그램에 기능을 추가해야 하는데 코드 구조가 조잡해서 그 기능을 추가하기 힘들다면, 우선 리팩토링을 실시해서 기능을 추가하기 쉽게 만든 후 그 기능을 추가해야 한다.
<hr/>

### 리팩토링 첫 단계
리팩토링할 코드 부분에 대한 신뢰도 높은 각종 테스트를 작성한다. 아무리 체계적인 리팩토링 공식을 이용해 버그가 생길 수 있는 대부분의 원인을 방지하더라도, 인간인 이상 실수할 수 있기 때문에 신뢰도 높은 테스트 작성은 필수다. 적절한 테스트 코드를 작성하는 것은 리팩토링의 기본이다. 테스트하면 나중에 프로그램을 수정할 때 필요한 안전성이 확보되므로 테스트를 작성하는 시간은 조금도 아깝지 않다. 

###### 리팩토링
* 긴 메서드를 보면 작은 부분들로 쪼갤 수 있는지 살펴본다. 코드를 잘게 쪼개면 관리도 편하고 다른 코드와 연동하거나 이리저리 옮기기도 쉽다.
* 논리적 코드 뭉치를 찾아 메서드 추출 기법을 적용한다. switch 문은 하나의 메서드로 빼는 것이 적절하게 보이는 덩어리다. 
* 리팩토링은 프로그램을 조금씩 단계적으로 수정하므로 실수해도 버그를 찾기가 쉽다.
* 좋은 코드는 그것이 무슨 기능을 하는지 분명히 드러나야 하는데, 코드의 기능을 분명히 드러내는 열쇠가 바로 직관적인 변수명이다. 인간이 이해할 수 있는 코드를 작성하는 것이 실력 있는 프로그래머다.
* 메서드는 대체로 자신이 사용하는 데이터와 같은 객체에 들어 있어야 한다. 
* 임시변수는 최대한 없애는 것이 좋다. 임시변수가 많으면 불필요하게 많은 매개변수를 전달하게 되는 문제가 흔히 생긴다. 심지어 임시변수의 용도를 차츰 잊기 십상이다. 임시변수는 특히 긴 메서드 안에서 알게 모르게 늘어나는데, 당연히 성능이 떨어진다. 
* 타 객체의 속성을 switch 문의 인자로 하는 것은 나쁜 방법이다. switch 문의 인자로는 타 객체 데이터를 사용하지 말고 자신의 데이터를 사용해야 한다.
* 하위클래스를 작성해 상속 구조를 만들면 switch 문을 재정의로 바꿀 수 있다.
<hr/>

### 고찰
리팩토링을 위해 메서드 추출, 메서드 이동, 조건문을 재정의로 전환 같은 기법들을 사용할 수 있다. 이런 기법들을 적용하면 기능 분배가 균등해지고 코드 유지보수도 쉬워진다. 
> '간단한 수정 -> 테스트'를 리듬처럼 반복해야 한다. 이 리듬을 지킬 때만이 리팩토링을 빠르고 안정적으로 완료할 수 있다. 
