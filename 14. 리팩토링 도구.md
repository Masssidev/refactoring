# 리팩토링 도구
코드 리팩토링에 제일 큰 장애 요인은 리팩토링에 사용할 도구가 별로 없다는 점이다.
<hr/>

### 도구를 이용한 리팩토링
자동화 도구를 사용해 리팩토링하는 것과 수작업으로 리팩토링하는 것은 차원이 다르다. 테스트 스위트를 사용해 적절히 안전망을 치더라도, 수작업으로 리팩토링하는 것은 시간 낭비다. 

리팩토링 비용을 코드 형식 정리 비용 수준으로 삭감하면 코드 정리 작업이 코드 외형 정리 작업과 비슷해질 우려가 있다. 그러나 이런식의 정리로 인해 코드의 유지모수, 재사용성, 가독성이 월등히 개선될 수도 있다.

리팩토링 도구를 사용하면 프로그래밍과 별도로 실시할 작업이 점점 줄어든다. 자동화 도구를 사용해 리팩토링한 후엔 테스트할 필요가 없으므로 각 작업으로의 진행이 흐름처럼 유연해진다.

리팩토링에 드는 시간과 수고가 줄어들수록 설계 오류의 발생 가능성도 줄어든다. 설계 오류를 수정하는 데 비교적 낮은 비용이 드니까 사전에 해야 할 설계도 줄어든다. 사전 설계는 요구사항이 완벽하지 않으므로 예측하는 작업이다. 코드가 없기에 코드를 간결하게 만들려면 어떻게 설계해야 하는지도 확실히 알 수 없다. 과거에는 설계 수정 비용이 어마어마해서 초기에 만든 설계가 어떻든 그대로 사용할 수밖에 없었다. 리팩토링 자동화 도구를 사용하면 설계를 고치는 비용이 훨씬 적게 드니까 설계를 더욱 유동적으로 할 수 있다. 나중에 저렴한 비용으로 더욱 유연하게 설계를 확장할 수 있음을 알기에 이렇게 새로 주어진 비용으로 현재의 문제 수준에 맞게 설계할 수 있다. 향후에 시스템이 바뀔 가능성이 있는 모든 경우를 예측할 필요가 없다. 

도구를 사용해 리팩토링하면 리팩토링 과정의 대부분이 자동으로 이뤄지니까 테스트할 일도 줄어든다. 자동화할 수 없는 리팩토링 단계는 항상 있기 마련이므로 절대로 테스트 단계가 없어질 일은 없다. 
<hr/>

### 리팩토링 도구의 기술적 요건
리팩토링 도구의 주 목적은 프로그래머가 프로그램을 다시 테스트할 필요 없이 코드를 리팩토링할 수 있게 하는 것이다. 자동화된 테스트라 해도 테스트는 시간 낭비이며, 테스트만 없어도 리팩토링 속도는 엄청나게 빨라질 수 있다.
* 프로그램 데이터 베이스
  * 특정 메서드에서 해당 메서드를 참조할 가능성이 있는 호출 부분을 전부 찾는 것 같이 프로그램 전반에 걸쳐 각종 프로그램 엔티티를 검색하는 기능이다. 이것은 기존에 알고 있는 데이터베이스가 아니라 '검색 기능 보관소'다. 개발자는 검색 기능을 이용해서 모든 프로그램 요소의 상호 참조 부분을 찾아낼 수 있는데, 이것이 가능한 주된 이유는 코드의 동적 컴파일 덕택이다. 어느 클래스에든 수정이 발생하는 즉시, 그 수정 코드가 바이트코드로 컴파일되며, 검색 가능 보관소가 업데이트 된다. 자바 같은 더 정적인 환경에서는 개발자가 텍스트 파일에 코드를 입력한다. 데이터베이스 업데이트는 반드시 이런 텍스트 파일을 처리하고 관련 정보를 추출하는 프로그램을 실행해서 수행해야 한다. 이러한 업데이트는 자바 코드 자체를 컴파일하는 것과 비슷하다. 
* 파스 트리
  * 대부분의 리팩토링은 시스템의 메서드 계층 하위 부분을 조작해야 한다. 이러한 부분은 주로 수정될 프로그램 요소를 참조한다. 메서드의 일부분을 별도의 메서드로 빼내는 등의 다른 리팩토링 기법은 전부 메서드 계층 하위에서 이뤄지는 것들이다. 어떠한 메서드 수정 작업이든 메서드 구조를 조작할 수 있어야 가능하다. 메서드 구조를 조작하려면 파스 트리를 이용해야 한다. 파스 트리는 메서드 자체의 내부 구조를 표현하는 데이터 구조다.
* 정확성
  * 도구를 사용해 리팩토링할 때도 당연히 기능은 그대로 유지되어야 한다. 기능을 완벽히 유지하기란 불가능하다. 기존의 프로그램에도 오류가 새로 생길 수 있다. 그러나 리팩토링은 대부분의 프로그램에 상당히 정확히 적용할 수 이싿. 리팩토링을 그르치는 다양한 경우만 알아낼 수 있으면 개발자는 해당 리팩토링을 우회하거나 리팩토링 도구가 수정하지 못하는 프로그램의 일부분을 수작업으로 수정할 수 있다.
<hr/>

### 리팩토링 도구의 실무적 요건
도구를 제작하는 목적은 사람이 할 특수한 작업을 보조하기 위해서다. 사람은 누구나 자신의 작업 방식에 맞지 않는 도구는 사용하지 않는다. 도구는 리팩토링 절차를 다른 도구와 연동해야 한다는 점이 가장 필수적인 요건이다.
* 속도
  * 코드가 아주 복잡할 땐 리팩토링하는 데 필요한 분석과 변환에 시간이 오래 걸릴 수 있다. 걸리는 시간에 비해 정확성을 위한 비용이 얼마나 드는지 반드시 고려해야 한다. 리팩토링에 시간이 너무 오래 걸릴 경우 개발자는 자동화 도구로 리팩토링하지 않고 수작업으로 수행하게 되어 결과에 대한 책임을 지게 된다.
  * 분석 속도가 너무 느릴 때 사용할 만한 방법은 그냥 도구가 개발자에게 그 분석 정보가 필요한지 묻는 것이다. 이렇게 하면 정확성이라는 책임이 개발자에게 돌아오지만 분석 속도는 빨라진다. 개발자는 대체로 필요한 정보를 알고 있다. 이 방법은 개발자가 필요성을 오판할 수 있어서 안전하지 않을 수 있지만, 대신에 오류의 책임이 개발자에게 있게 된다. 아이러니지만, 이로 인해 개발자는 프로그램을 이리저리 조작해보면서 정보를 찾지 않아도 되므로 오히려 도구를 사용할 가능성이 높아진다.
* 작업 취소
  * 도구를 사용한 자동 리팩토링을 하면 설계에 실험적인 방법을 적용할 수 있다. 코드를 이리저리 수정하면서 새로운 설계의 내부 코드가 어떤 형태인지 볼 수 있다. 리팩토링은 기능 보전을 전제로 하기에, 리팩토링한 코드를 원상태로 돌리는 작업 즉 리팩토링 취소 또한 일종의 리팩토링이며 기능이 보전된다. 과거의 어느 버전으로든 되돌릴 수 있으니 걱정없이 코드를 리팩토링할 수 있다.
* 도구와 연동
  * 통합 개발 환경(IDE)은 대부분의 개발 프로젝트에 필수적이다시피 사용된다. 통합 개발 환경에는 편집기, 컴파일러, 링커, 디버거를 비롯해 프로그램 개발에 필요한 각종 도구가 합쳐져 있다. 리팩토링 기능을 통합해서 도구를 바로 사용할 수 있게 붙여 놓으면 자주 사용할 것이다.

소프트웨어 프로젝트를 초기에 자주 업그레이드할 때 발생하는 복잡성을 관리하는 최선의 방법은 자동 리팩토링 도구를 사용하는 것이다. 이런 복잡성을 도구를 사용하지 않고 처리하다가는 소프트웨어가 쓸데없이 복잡해지고 버그가 많아지고 고장나기 쉬워진다. 자바는 문법이 비슷한 타 언어에 비해 간단하므로, 리팩토링 도구를 개발하기도 훨씬 쉽다.

 
