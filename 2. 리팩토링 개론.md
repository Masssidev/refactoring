# 리팩토링 개론
### 리팩토링은 무엇인가
1. 겉으로 드러나는 기능은 그대로 둔 채, 알아보기 쉽고 수정하기 간편하게 소프트웨어 내부를 수정하는 작업
2. 리팩토링 기법을 연달아 적용해서 겉으로 드러나는 기능은 그대로 둔 채 소프트웨어 구조를 변경한다.
> 리팩토링으로 인해 코드 효율성이 높아지고 구조도 체계화된다는 점을 생각해볼 때 리팩토링은 단순한 코드 정리보다는 더 포괄적인 개념이다.
* 리팩토링의 목적은 소프트웨어를 더 이해하기 쉽고 수정하기 쉽게 만드는 것이다. 리팩토링을 수행하면 겉으로 드러나는 기능에 거의 또는 아예 영향을 주지 않은 채 소프트웨어의 각종 기능을 변경할 수 있다. 
* 리팩토링은 겉으로 드러나는 소프트웨어 기능에 영향을 주지 않는다. 따라서 리팩토링하기 전의 소프트웨어 기능은 리팩토링을 수행하고 나서도 그대로이며, 최종 사용자나 다른 프로그래머는 그 소프트웨어에 변화가 있음을 눈치채지 못한다.
###### 소프트웨어 개발에 리팩토링을 적용할 때 기능 추가와 리팩토링이라는 별개의 두 작업에 시간을 분배해야 한다. 
기능을 추가할 땐 코드를 수정하지 말고 기능만 추가해야 한다. 진행 상태를 파악하려면 테스트를 추가하고 그 테스트들이 제대로 되는지 알아내면 된다. 리팩토링할 때는 코드를 추가하지 말고 코드 구조 개선만 해야 한다. 앞서 실수한 게 없다면 테스트는 전혀 추가하지 말고 오로지 코드 구조만 수정해야 한다. 추가로 인터페이스가 변경되어 그에 맞게 코드를 고치는 것이 불가피할 땐 테스트만 변경해야 한다.
<hr/>

### 리팩토링은 왜 해야 하나
리팩토링이 모든 소프트웨어 문제를 해결하는 만병통치약은 아니지만, 리팩토링의 가치는 확실하며 적어도 코드를 언제든 쉽게 이해할 수 있게 만드는 도구임엔 틀림없다. 리팩토링은 다양한 용도로 사용 가능하므로, 다양한 용도로 사용하는 것이 마땅하다.
* 소프트웨어 설계가 개선된다.
* 소프트웨어를 이해하기가 더 쉬워진다.
* 버그를 찾기가 쉬워진다.
* 프로그래밍 속도가 빨라진다. 
<hr/>

### 리팩토링은 어떨 때 필요한가
리팩토링은 따로 시간을 정해서 하면 안 되고 일상적으로 틈틈이 해야 한다. 리팩토링은 작정해서 하는 게 아니라, 뭔가 다른 걸 해야 겠는데 리팩토링을 실시하면 그 작업이 쉬워지기 때문에 하는 것이다.
* 같은 작업의 삼진 아웃 때
  * 같은 작업을 3번째 반복하게 됐을 때 리팩토링을 실시한다.
* 기능을 추가할 때
* 버그를 수정할 때
* 코드를 검수할 때
<hr/>

### 리팩토링의 효용성
프로그램이 수정하기 힘들 때
* 코드를 알아보기 힘들 때
* 중복된 로직이 들어 있을 때
* 추가 기능을 넣어야 해서 실행 중인 코드를 변경해야 할 때
* 조건문 구조가 복잡할 때
> 프로그램은 코드를 알아보기 쉽고, 모든 로직이 한 곳에 있으며, 기존 기능을 건드릴 필요 없이 조건문 구조가 최대한 간결하게끔 작성해야 한다.

> 리팩토링은 실행 중인 프로그램의 기능을 바꾸는 작업이 아니고 신속한 개발 공정을 가능하게 하는 이런 성질을 가중하면서 가치를 높이는 일이다.
<hr/>

### 인다이렉션과 리팩토링
소프트웨어 개발자의 임무는 전문가로서 효과적인 소프트웨어를 최대한 신속히 제작하기만 하면 된다. 리팩토링은 소프트웨어 개발 속도를 높이는 데 큰 도움이 된다. 

한 부분을 쪼개면 관리할 부분이 늘어난다. 그리고 한 객체가 다른 객체에 작업을 위임하고 그 객체가 또 다른 객체에 작업을 위임하기 때문에 코드가 알아보기 힘들어질 수도 있다. 그러므로 인다이렉션을 사용하는 것은 가능하면 자제하는 것이 좋다. 

하지만 인다이렉션도 장점이 있다.
* 로직을 공유
  * 두 위치에서 호출되는 하위 메서드나 모든 하위클래스가 공유하는 상위클래스의 메서드 등이 있다.. 이런 식으로 하나의 로직을 여러 곳에서 공유할 수 있다.
* 의도와 구현부를 따로 나타냄
  * 클래스명과 메서드명을 정해서 의도한 바를 드러낼 수 있고, 클래스나 메서드의 내부 코드를 통해 그 의도를 어떻게 구현했는지 보여줄 수 있다. 내부 코드를 다시 더 잘게 쪼개어 의도적인 측면에서 작성했다면 그 코드의 구조에 대한 대부분의 주요 정보를 잘 드러내는 코드를 작성할 수 있다.
* 수정 부분을 분리
  * 한 객체를 두 위치에 사용했는데 두 경우 중 한 상황에 대해 동작을 수정해야 할 때 그 객체를 수정하면 두 상황이 모두 변경될 위험이 있다. 따라서 우선 하위클래스를 만들고 변하는 경우에 참조하게 만들어야 한다. 그러면 다른 경우로 예기치 못하게 변할 위험을 감수하지 않고 클래스를 수정할 수 있다.
* 조건문을 코드화
  * 객체에는 재정의 메시지라는 우수한 메커니즘이 존재해서 조건문을 유연하면서도 분명하게 표현할 수 있다. 조건문을 메시지로 바꾸면 중복 코드가 줄어들어 명료해지며 동시에 유연성도 높아진다.
> 인다이렉션의 장점이 발휘되지 못하는 부분을 확인한 후 기존 동작을 건드리지 않고 그 인다이렉션을 넣으면 프로그램의 품질이 향상되서 가치가 더 높아지며 향후 수정하기도 편해진다. 

> 불필요한 인다이렉션을 찾아 없앨 수 있어야 한다. 숨어 있는 인다이렉션을 발견했다면 없애야 한다. 
<hr/>

### 리팩토링 관련 문제들
리팩토링의 장점을 손에 넣으려면 리팩토링을 실제로 실시하는 것도 중요하지만 과정을 모니터링하는 것도 중요하다. 리팩토링으로 인해 생길 수 있는 문제점에 주의해야 한다. 
* 데이터베이스
  * 수많은 비즈니스 애플리케이션은 바탕이 되는 데이터베이스 스키마와 강력히 결합되어 있다. 이 때문에 데이터베이스 수정이 어려워진다. 또 데이터 이전 문제도 생긴다. 
* 인터페이스 변경
  * 객체의 중대한 장점 하나는 인터페이스를 건드리지 않고 내부의 구현 코드를 수정할 수 있다는 점이다. 객체를 이용하는 부분을 수정하지 않고도 객체의 내부 구조를 안전하게 수정할 수 있지만, 인터페이스를 수정하면 무슨 문제가 생길지 알 수 없으므로 인터페이스를 건드리지 않을 수 있다는 것은 큰 장점이다. 하지만 리팩토링이 인터페이스를 건드릴 수 있다. 
* 리팩토링을 어렵게 하는 설계를 수정하는 일
* 리팩토링하면 안 되는 상황
  * 코드를 처음부터 새로 작성해야 할 때
  * 납기가 임박했을 때
> 언제나 시간에 쫓긴다면 그건 리팩토링해야 한다는 신호다.
<hr/>

### 리팩토링과 설계
* 리팩토링은 설계를 보완하는 특수한 역할을 한다.
* 리팩토링을 실시하면 유연성을 낮추지 않고도 더 간결한 설계가 가능해진다.
> 시스템 내부가 어떻게 돌아가는지 정확히 알고 있더라도 추측하지 말고 성능 측정을 실시해야 한다. 성능 측정을 하지 않고 추측에 의존하면 추측은 거의 대부분 틀린다. 
<hr/>

### 리팩토링과 성능
소프트웨어는 속도가 느린 것이 용납되지 않으며, 하드웨어 성능이 빨라질수록 그에 맞춰 소프트웨어 속도에 대한 기대나 기준도 더 높아진다. 리팩토링을 실시하면 분명 소프트웨어는 더 느려지지만, 소프트웨어 성능을 더 간단히 조절할 수 있다. 소프트웨어 성능을 올리려면 먼저 소프트웨어를 튜닝 가능하게 만들어 놓고 나중에 충분한 속도가 나오게 튜닝하는 것이다. 이것은 철저한 실시간 환경을 제외한 모든 환경에 적용된다. 
###### 빠른 소프트웨어를 작성할 수 있는 일반적인 세 가지 방법
1. 철저한 실시간 시스템에 주로 사용되는 시간 분배.
  * 설계를 분해하면서 각 구성 요소에 시간이나 메모리 사용량 같은 자원별 예산을 할당한다.
2. 성능에 꾸준한 관심을 갖는다.
  * 모든 개발자는 성능을 높게 유지하기 위해 수단과 방법을 가리지 말아야 한다.
3. 개발자가 대개 개발 정차 중 후기 단계에 있는 성능 최적화 전까지는 성능에 신경 쓰지 않고 프로그램을 잘 쪼개진 방식으로 제작한다. 성능 최적화 단계에서는 이 프로그램을 튜닝하는 특수 절차를 따른다.
###### 프로그램을 잘 쪼개면 두 가지 측면에서 최적화 방식에 도움이 된다.
1. 성능 튜닝에 할애할 시간이 생긴다. 코드가 잘 쪼개져 있어서 기능 추가도 더 신속히 이뤄진다. 이로 인해 더 많은 시간을 성능에만 집중할 수 있다. 
2. 성능을 분석할 때 더 정밀한 분석이 가능해진다. 
> 리팩토링하는 동안에는 단기적으로 소프트웨어가 느려지지만, 최적화를 거치면서 튜닝하기가 훨씬 쉬워져서 결과적으로는 소프트웨어 개발이 더 빨라진다.
<hr/>

### 리팩토링의 유래
유능한 프로그래머들은 깔끔한 코드가 복잡하고 정신없는 코드에 비해 나중에 수정하기 편하다는 것을 경험을 통해 알고 있기도 하고, 초반부터 깔끔한 코드를 작성하기란 거의 불가능하다는 것도 알고 있다.
> 리팩토링은 코드를 깔끔하게 만드는 것 이상의 순기능을 한다. 

